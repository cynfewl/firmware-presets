#$ TITLE: d1g1t4lb0y - 1-2S Whoop
#$ FIRMWARE_VERSION: 4.3
#$ CATEGORY: TUNE
#$ STATUS: EXPERIMENTAL
#$ KEYWORDS: whoop, 65mm, 75mm, 1S, 2S, race, acro, tune, brushless
#$ AUTHOR: d1g1t4lb0y

#$ DESCRIPTION: Base tune for a 1-2S Whoop that is based on the HappyModel Mobula7 1S default tune but customised to include RPM Filtering.
#$ DESCRIPTION: In my testing this works fine for 65mm with 31mm and 35mm props and 75mm with bi-blades.
#$ DESCRIPTION:
#$ DESCRIPTION: Note that this requires Bluejay ESC or other firmware that includes bidirectional DSHOT.
#$ DESCRIPTION: I mostly use 24khz for less than 22,000kv and 48khz for higher, unless 24khz gives me particularly short flight times.
#$ DESCRIPTION:
#$ DESCRIPTION: The 2S tune is loosely based around halving the P and D for the 1S tune, which was a recommendation from Patrick J. Clark.
#$ INCLUDE: presets/4.3/tune/defaults.txt
#$ INCLUDE: presets/4.3/filters/defaults.txt

# -- Bidirection DSHOT --
set dshot_bidir = ON
set motor_pwm_protocol = DSHOT300
set motor_poles = 12
set rpm_filter_harmonics = 2
set rpm_filter_min_hz = 100

# -- Filter Settings --
set gyro_lpf1_static_hz = 0
set gyro_lpf2_static_hz = 0
set yaw_lowpass_hz = 0
set dyn_notch_count = 1
set dyn_notch_q = 450
set dyn_notch_min_hz = 100
set dyn_notch_max_hz = 800

# -- Filter Sliders --
set simplified_dterm_filter = ON
set simplified_dterm_filter_multiplier = 130
set simplified_gyro_filter = ON
set simplified_gyro_filter_multiplier = 130

# -- PID Settings --
set d_max_advance = 0
set dyn_idle_min_rpm = 40
set pidsum_limit = 1000
set pidsum_limit_yaw = 1000
set throttle_boost = 0

#$ OPTION_GROUP BEGIN: Battery Cells (Choose One)

#$ OPTION BEGIN (CHECKED): 1S

# -- PID Sliders --
set simplified_master_multiplier = 145
set simplified_i_gain = 65
set simplified_d_gain = 185
set simplified_pi_gain = 190
set simplified_dmax_gain = 0
set simplified_feedforward_gain = 130
set simplified_pitch_d_gain = 85
set simplified_pitch_pi_gain = 90
set simplified_dterm_filter_multiplier = 130

simplified_tuning apply

#$ OPTION END

#$ OPTION BEGIN (UNCHECKED): 2S

# -- PID Sliders --
set simplified_master_multiplier = 145
set simplified_i_gain = 65
set simplified_dmax_gain = 0
set simplified_feedforward_gain = 130
set simplified_pitch_d_gain = 85
set simplified_pitch_pi_gain = 90
set simplified_dterm_filter_multiplier = 130

simplified_tuning apply

#$ OPTION END

#$ OPTION_GROUP END